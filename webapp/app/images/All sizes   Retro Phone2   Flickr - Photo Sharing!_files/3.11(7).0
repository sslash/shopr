YUI.add("timing-average",function(b){var d={cookies:{before_unload:"flta_ul",load_total_time_spent:"flta_lt",load_count:"flta_lc"},expiry_times:{before_unload:1000*60*1,expiry_default:1000*60*60*8},cookie_options:{domain:".flickr.com",path:"/"}},f=0,g={before_unload:0,load_time:0,load_count:0,load_average:0};function k(){b.Cookie.remove(d.cookies.before_unload,d.cookie_options)}function m(o){var p=(o||{});if(typeof p.is_photogne_page!=="undefined"&&p.is_photogne_page){c();if(i()){b.one(window).on("load",function(){setTimeout(function(){if(typeof F._timing_avg!=="undefined"){l();f=F._timing_avg._page_load-g.before_unload;e();a()}else{b.log("timing-average: WARN: F._timing_avg is undefined")}},20)})}else{k()}}else{k()}}function l(){g.before_unload=parseInt(b.Cookie.get(d.cookies.before_unload)||0,10);b.Cookie.remove(d.cookies.before_unload,d.cookie_options);g.load_time=parseInt(b.Cookie.get(d.cookies.load_total_time_spent)||0,10);g.load_count=parseInt(b.Cookie.get(d.cookies.load_count)||0,10);g.load_average=parseInt(g.load_time/g.load_count,10);if(isNaN(g.load_average)){g.load_average=0}}function a(){var p=new Date(new Date().getTime()+(d.expiry_times.expiry_default)).toGMTString(),o={domain:".flickr.com",path:"/",expires:new Date(p)};if(g.before_unload){b.log("storing new load time/count: "+g.load_time+"/"+g.load_count+" with cookie expiry: "+p,"info","timing-average");g.load_average=parseInt(g.load_time/g.load_count,10);b.Cookie.set(d.cookies.load_total_time_spent,g.load_time,o);b.Cookie.set(d.cookies.load_count,g.load_count,o)}}function e(){g.load_count+=1;g.load_time+=parseInt(f,10)}function j(){var o=parseInt(f);if(isNaN(o)){o=0}return o}function n(){return parseInt(g.load_average,10)}function h(){var o;for(o in d.cookies){if(d.cookies.hasOwnProperty(o)){b.log("removing "+d.cookies[o]);b.Cookie.remove(d.cookies[o],d.cookie_options)}}}function i(){var o=/\/photos\/[^\/]+\/\d+?/;return(document.referrer&&o.test(document.referrer))}function c(){b.one(window).on("beforeunload",function(){var q=new Date(new Date().getTime()+(d.expiry_times.before_unload)).toGMTString(),p={domain:".flickr.com",path:"/",expires:new Date(q)},o=new Date().getTime();b.Cookie.set(d.cookies.before_unload,o,p)})}b.timingAverage={init:m,get_this_page_time:j,get_average_time:n};if(typeof F._timing_avg!=="undefined"){F._timing_avg.reset=h}},"0.0.1",{requires:["event","cookie"]});